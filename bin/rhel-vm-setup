#! /bin/bash
#

set -e
set -u

if [[ $UID -ne 0 ]]; then
    echo "ERROR: This script must be run as root"
    exit 1
fi

cd ~root

# https://fedoraproject.org/wiki/EPEL/FAQ#howtouse
if ! (rpm -q epel-release > /dev/null)
then
    rpm -Uvh http://download.fedora.redhat.com/pub/epel/5/i386/epel-release-5-3.noarch.rpm
fi

# Puppet Packages
# 0.25.4 At the time of this writing

if ! (rpm -q puppet > /dev/null); then
    yum -y install puppet
fi

# Install git to get the puppet-demotools repository
puppet -v <<EOF
package { git: ensure => installed }
EOF

# Clone puppet-demotools
if ! test -d puppet-demotools
then
    git clone https://jeffmccune@github.com/jeffmccune/puppet-demotools.git
fi

# Execute puppet to setup the rest of the system
exec puppet-demotools/puppet-setup-demo
